CC=g++ # probably wrong but oh well.
INCLUDEDIR=../include
ANOPELIBS=@ANOPELIBS@
CFLAGS=@CFLAGS@ -Wall -ansi -pedantic -Wshadow
PROFILE=-pg
LDPROFILE=
SHELL=/bin/sh
BINDEST=@BINDEST@
DATDEST=@DATDEST@
INSTALL=@INSTALL@
RM=@RM@
CP=@CP@
TOUCH=@TOUCH@
MODULE_PATH=@MODULE_PATH@
MYSQL=@MYSQL@
RDB=@RDB@
LDFLAGS=@LDFLAGS@
RUNGROUP=@RUNGROUP@
SHARED=@SHARED@
MODULEFLAGS=@MODULEFLAGS@

all:   language headers build core protocols tools modules 
profile: language headers profile_build profile_core profile_protocols profile_tools profile_modules

MAKEARGS = 'CFLAGS=${CFLAGS}' 'CC=${CC}' 'ANOPELIBS=${ANOPELIBS}' \
	   'LDFLAGS=${LDFLAGS}' 'BINDEST=${BINDEST}' 'INSTALL=${INSTALL}' \
           'INCLUDEDIR=${INCLUDEDIR}' 'RM=${RM}' 'CP=${CP}' \
      	   'TOUCH=${TOUCH}' 'SHELL=${SHELL}' 'DATDEST=${DATDEST}' \
  	   'RUNGROUP=${RUNGROUP}' 'MODULE_PATH=${MODULE_PATH}' 'RDB=${RDB}'\
	   'MYSQL=${MYSQL}' 'SHARED=${SHARED}' 'MODULEFLAGS=${MODULEFLAGS}'

build: language headers
	@${MAKE} -C src ${MAKEARGS} all

profile_build:
	@${MAKE} -C src ${MAKEARGS} 'CFLAGS=${CFLAGS} $(PROFILE)' 'LDFLAGS=${LDFLAGS} ${PROFILE}' all

modules: build
	@src/modules/configure src/modules
	@${MAKE} -C src/modules ${MAKEARGS} all
	@echo "*** All done, now (g)make install to install Anope/Modules";

clean_modules:
	@${MAKE} -C src ${MAKEARGS} clean_modules

distclean_modules:
	@${MAKE} -C src ${MAKEARGS} distclean_modules

protocols: build
	@echo "*** Building protocol support";
	@src/protocol/configure src/protocol
	@${MAKE} -C src/protocol ${MAKEARGS} all

profile_protocols: build
	@echo "*** Building protocol support";
	@src/protocol/configure src/protocol
	@${MAKE} -C src/protocol ${MAKEARGS} 'CFLAGS=${CFLAGS} ${PROFILE}' 'PROFILE=${PROFILE}' all

core: build 
	@echo "*** Building Core modules";
	 @${MAKE} -C src ${MAKEARGS} core

profile_core: build 
	@echo "*** Building Core modules";
	@${MAKE} -C src ${MAKEARGS} 'CFLAGS=${CFLAGS} ${PROFILE}' 'PROFILE=${PROFILE}' core

tools: build
	@${MAKE} -C src/tools ${MAKEARGS} all
	@echo "*** All done, now (g)make install to install Anope/Modules/Tools";

profile_tools: profile_build
	@${MAKE} -C src/tools ${MAKEARGS} 'CFLAGS=${CFLAGS} $(PROFILE)' all
	@echo "*** All done, now (g)make install to install Anope/Modules/Tools";

profile_modules: profile_build
	@src/modules/configure src/modules
	@${MAKE} -C src/modules ${MAKEARGS} 'CFLAGS=${CFLAGS} ${PROFILE}' 'PROFILE=${PROFILE}' all
	@echo "*** All done, now (g)make install to install Anope/Modules";

language:
	@$(MAKE) -C lang ${MAKEARGS} all language.h

headers:
	@${MAKE} -C include ${MAKEARGS}

clean:
	${MAKE} -C lang ${MAKEARGS} clean
	${MAKE} -C include ${MAKEARGS} clean
	${MAKE} -C src ${MAKEARGS} clean
	${MAKE} -C src/tools ${MAKEARGS} clean
                
distclean: clean
	${MAKE} -C lang ${MAKEARGS} distclean
	${MAKE} -C include ${MAKEARGS} distclean
	${MAKE} -C src ${MAKEARGS} distclean
	${MAKE} -C src/tools ${MAKEARGS} distclean
	rm -f config.log config.status config.cache Makefile src/bin/anoperc

install: DUMMY
	${MAKE} -C src ${MAKEARGS} install
	${MAKE} -C src/tools ${MAKEARGS} install
	@echo "*** All done, Anope is now installed. Please read docs/INSTALL for details on what to do now.";

DUMMY:
