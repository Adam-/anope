CC=@CC@
INCLUDEDIR=../include
ANOPELIBS=@ANOPELIBS@
CFLAGS=@CFLAGS@
STRICT=-Wall -ansi -pedantic
PROFILE=-pg
LDPROFILE=
SHELL=/bin/sh
SUBDIRS=src
BINDEST=@BINDEST@
DATDEST=@DATDEST@
INSTALL=@INSTALL@
RM=@RM@
CP=@CP@
TOUCH=@TOUCH@
MODULE_PATH=@MODULE_PATH@
MYSQL=@MYSQL@
RDB=@RDB@
LDFLAGS=@LDFLAGS@
RUNGROUP=@RUNGROUP@
IRCDFILE=@IRCDFILE@

all:   language headers build tools modules 
strict: language headers strict_build tools strict_modules
profile: language headers profile_build tools profile_modules

MAKEARGS = 'CFLAGS=${CFLAGS}' 'CC=${CC}' 'ANOPELIBS=${ANOPELIBS}' \
	   'LDFLAGS=${LDFLAGS}' 'BINDEST=${BINDEST}' 'INSTALL=${INSTALL}' \
           'INCLUDEDIR=${INCLUDEDIR}' 'RM=${RM}' 'CP=${CP}' \
      	   'TOUCH=${TOUCH}' 'SHELL=${SHELL}' 'DATDEST=${DATDEST}' \
  	   'RUNGROUP=${RUNGROUP}' 'MODULE_PATH=${MODULE_PATH}' 'RDB=${RDB}'\
	   'MYSQL=${MYSQL}' 'IRCDFILE=${IRCDFILE}'

build:
	@for i in $(SUBDIRS); do \
            echo "*** Building $$i";\
            ( cd $$i; ${MAKE} ${MAKEARGS} all; ) \
        done

strict_build:  
	@for i in $(SUBDIRS); do \
            echo "*** Strict Building $$i";\
            ( cd $$i; ${MAKE} ${MAKEARGS} 'CFLAGS=${CFLAGS} $(STRICT)' all; ) \
        done

profile_build:
	@for i in $(SUBDIRS); do \
            echo "*** Strict Building $$i";\
            ( cd $$i; ${MAKE} ${MAKEARGS} 'CFLAGS=${CFLAGS} $(PROFILE)' 'LDFLAGS=${LDFLAGS} ${PROFILE}' all; ) \
        done

modules: build
	(cd src/modules ; ./configure ; ${MAKE} ${MAKEARGS} all; )
	@echo "*** All done, now (g)make install to install Anope/Modules";

tools: build
	(cd src/tools ; ${MAKE} ${MAKEARGS} all; )
	@echo "*** All done, now (g)make install to install Anope/Modules/Tools";

strict_modules: strict_build
	(cd src/modules ; ./configure ; ${MAKE} ${MAKEARGS} 'CFLAGS=$(CFLAGS) $(STRICT)' all; )
	@echo "*** All done, now (g)make install to install Anope/Modules";

profile_modules: profile_build
	(cd src/modules ; ./configure ; ${MAKE} ${MAKEARGS} 'CFLAGS=${CFLAGS} ${PROFILE}' 'PROFILE=${PROFILE}' all; )
	@echo "*** All done, now (g)make install to install Anope/Modules";

language:
	(cd lang ; $(MAKE) ${MAKEARGS} all language.h ; cp language.h ../include/)

headers:
	(cd include ; ${MAKE} ${MAKEARGS} )

clean:
	(cd lang ; ${MAKE} ${MAKEARGS} clean )
	(cd include ; ${MAKE} ${MAKEARGS} clean )
	(cd src ; ${MAKE} ${MAKEARGS} clean )
	(cd src/tools ; ${MAKE} ${MAKEARGS} clean )

distclean: clean
	(cd lang ; ${MAKE} ${MAKEARGS} distclean )
	(cd include ; ${MAKE} ${MAKEARGS} distclean )
	(cd src ; ${MAKE} ${MAKEARGS} distclean )
	(cd src/tools ; ${MAKE} ${MAKEARGS} distclean )
	rm -f config.log config.status config.cache Makefile

install: DUMMY
	(cd src ; ${MAKE} ${MAKEARGS} install)
	(cd src/tools ; ${MAKE} ${MAKEARGS} install)

DUMMY:
